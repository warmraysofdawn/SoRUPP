<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Галереи - {{ data.site_title }}</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .gallery-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        .gallery-container {
            margin-top: 15px;
        }
        
        .gallery-images {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .gallery-images img {
            width: 100%;
            height: auto;
            border-radius: 4px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .gallery-images img:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="portfolio-header">
            {% if data.portfolio.portrait %}
            <img src="portrait/{{ data.portfolio.portrait }}" alt="{{ data.portfolio.fullName }}" class="portfolio-avatar">
            {% endif %}
            <h1 class="portfolio-title">{{ data.portfolio.fullName }}</h1>
            <p class="portfolio-quote">{{ data.portfolio.quote }}</p>
        </header>
        
        <nav class="portfolio-nav">
            <ul>
                <li><a href="index.html">Обо мне</a></li>
                <li><a href="works.html">Мои работы</a></li>
                <li><a href="graph.html">Дерево творчества</a></li>
                <li><a href="downloads.html">Скачать все работы</a></li>
                <li><a href="gallery.html" class="active">Галереи</a></li>
            </ul>
        </nav>
        
        <main>
            <section class="portfolio-section">
                <h2>Галереи изображений</h2>
                <p>Здесь представлены все мои галереи изображений.</p>
                
                {% if data.galleries and data.galleries | length > 0 %}
                    {% for gallery in data.galleries %}
                    <div class="gallery-section">
                        <h3>{{ gallery.title }}</h3>
                        {% if gallery.description %}
                        <p>{{ gallery.description }}</p>
                        {% endif %}
                        
                        <div class="gallery-images">
                            {% for image in gallery.images %}
                            <img src="galleries/{{ image }}" alt="{{ gallery.title }} - Изображение {{ loop.index }}" 
                                 onclick="openLightbox('gallery-{{ gallery.id }}', '{{ image }}')">
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <p>Галереи еще не созданы.</p>
                {% endif %}
            </section>
        </main>
        
        <footer class="portfolio-footer">
            <a href="https://github.com/warmraysofdawn/SoRUPP" target="blank">Сайт создан при помощи СРКЦН</a>
        </footer>
    </div>
    
    <!-- Лайтбокс для просмотра изображений -->
    <div id="lightbox" class="lightbox hidden">
        <div class="lightbox-content">
            <span class="close" onclick="closeLightbox()">&times;</span>
            <img id="lightbox-img" src="" alt="">
            <div class="lightbox-nav">
                <button id="lightbox-prev" onclick="navigateLightbox(-1)">&#10094;</button>
                <button id="lightbox-next" onclick="navigateLightbox(1)">&#10095;</button>
            </div>
        </div>
    </div>

<script>
    // Данные галерей для JavaScript
    const galleryData = {{ data.galleries | tojson }};
    let currentImages = []; // Все изображения для навигации
    let currentImageIndex = 0;
    
    // Функция для открытия лайтбокса (УПРОЩЕННАЯ ВЕРСИЯ)
    function openLightbox(galleryId, imageName) {
        // Собираем все изображения из всех галерей для навигации
        currentImages = [];
        galleryData.forEach(gallery => {
            gallery.images.forEach(img => {
                currentImages.push({
                    src: `../galleries/${img}`,
                    galleryTitle: gallery.title,
                    imageName: img
                });
            });
        });
        
        // Находим индекс текущего изображения
        currentImageIndex = currentImages.findIndex(img => img.imageName === imageName);
        if (currentImageIndex === -1) return;
        
        // Показываем изображение
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightbox-img');
        lightboxImg.src = currentImages[currentImageIndex].src;
        lightboxImg.alt = currentImages[currentImageIndex].galleryTitle + ' - Изображение ' + (currentImageIndex + 1);
        lightbox.classList.remove('hidden');
        
        // Обновляем навигацию
        updateLightboxNav();
        
        // Блокируем прокрутку body
        document.body.style.overflow = 'hidden';
    }
    
    // Функция для закрытия лайтбокса
    function closeLightbox() {
        const lightbox = document.getElementById('lightbox');
        lightbox.classList.add('hidden');
        document.body.style.overflow = '';
    }
    
    // Функция для навигации по изображениям
    function navigateLightbox(direction) {
        currentImageIndex += direction;
        
        // Зацикленная навигация
        if (currentImageIndex < 0) {
            currentImageIndex = currentImages.length - 1;
        } else if (currentImageIndex >= currentImages.length) {
            currentImageIndex = 0;
        }
        
        // Обновляем изображение
        const lightboxImg = document.getElementById('lightbox-img');
        lightboxImg.src = currentImages[currentImageIndex].src;
        lightboxImg.alt = currentImages[currentImageIndex].galleryTitle + ' - Изображение ' + (currentImageIndex + 1);
        
        // Обновляем навигацию
        updateLightboxNav();
    }
    
    // Функция для обновления навигации в лайтбоксе
    function updateLightboxNav() {
        const prevBtn = document.getElementById('lightbox-prev');
        const nextBtn = document.getElementById('lightbox-next');
        
        // Всегда показываем кнопки (навигация зациклена)
        prevBtn.style.visibility = 'visible';
        nextBtn.style.visibility = 'visible';
    }
    
    // Закрытие лайтбокса по клику на фон
    document.getElementById('lightbox').addEventListener('click', function(e) {
        if (e.target === this) {
            closeLightbox();
        }
    });
    
    // Навигация с помощью клавиатуры
    document.addEventListener('keydown', function(e) {
        const lightbox = document.getElementById('lightbox');
        if (lightbox.classList.contains('hidden')) return;
        
        if (e.key === 'Escape') {
            closeLightbox();
        } else if (e.key === 'ArrowLeft') {
            navigateLightbox(-1);
        } else if (e.key === 'ArrowRight') {
            navigateLightbox(1);
        }
    });
</script>
    
</body>
</html>